<!DOCTYPE html>
<html>
<head>
    <title>OS Virtual Lab</title>
    <style>
        /* General Styles */
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1, h2, h3 {
            color: #0056b3;
        }

        /* Tab Styles */
        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            font-size: 17px;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #ccc;
        }

        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
        }

        /* Simulation Styles */
        .process {
            border: 1px solid black;
            padding: 5px;
            margin: 5px;
        }

        #pcb-display {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }

        #pcb-display h3 {
            margin-top: 0;
        }

        #pcb-display p {
            margin-bottom: 5px;
        }

        #pcb-display input[type="number"] {
            width: 60px;
        }

        #log {
            margin-top: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            height: 100px;
            overflow-y: scroll;
        }

        #log p {
            margin-bottom: 5px;
        }

        /* Quiz Styles */
        .quiz-question {
            margin-bottom: 15px;
        }

        .quiz-options label {
            display: block;
            margin-bottom: 5px;
        }

        .quiz-feedback {
            font-weight: bold;
        }

        #quiz-results {
            margin-top: 20px;
            font-size: 1.2em;
        }

        /* Accessibility */
        button:focus,
        input:focus {
            outline: 2px solid #007bff;
        }
    </style>
</head>
<body>

    <h1>OS Virtual Lab</h1>

    <div class="tab">
        <button class="tablinks" onclick="openTab(event, 'Home')" id="defaultOpen">Introduction/Home</button>
        <button class="tablinks" onclick="openTab(event, 'Aim')">Aim</button>
        <button class="tablinks" onclick="openTab(event, 'Theory')">Theory</button>
        <button class="tablinks" onclick="openTab(event, 'Objective')">Objective</button>
        <button class="tablinks" onclick="openTab(event, 'Procedure')">Procedure</button>
        <button class="tablinks" onclick="openTab(event, 'Simulation')">Simulation</button>
        <button class="tablinks" onclick="openTab(event, 'Pretest')">Pretest Questions</button>
    </div>

    <div id="Home" class="tabcontent">
        <h2>Introduction/Home</h2>
        <p>Welcome to the Operating Systems Virtual Lab! This interactive website is designed to help you understand the fundamental concepts of operating systems, particularly process management. An operating system (OS) is the software that manages computer hardware and software resources and provides common services for computer programs. Process management is a key function of the OS, involving the creation, scheduling, and termination of processes.</p>
        <p>This lab focuses on visualizing process states, the Process Control Block (PCB), and the context switching mechanism. Through interactive simulations and pretest questions, you will gain a deeper understanding of how operating systems manage processes.</p>
    </div>

    <div id="Aim" class="tabcontent">
        <h2>Aim</h2>
        <p>To understand and visualize the process of context switching in an operating system.</p>
    </div>

    <div id="Theory" class="tabcontent">
        <h2>Theory</h2>
        <h3>Processes and Process States</h3>
        <p>A process is an instance of a program in execution. Processes go through different states during their lifecycle:</p>
        <ul>
            <li><b>Ready:</b> The process is waiting to be assigned to a processor.</li>
            <li><b>Running:</b> The process is being executed by the processor.</li>
            <li><b>Waiting:</b> The process is waiting for some event to occur (e.g., I/O completion).</li>
            <li><b>Terminated:</b> The process has completed its execution.</li>
        </ul>

        <h3>Process Control Block (PCB)</h3>
        <p>The Process Control Block (PCB) is a data structure used by the operating system to store all the information about a process. Key fields include:</p>
        <ul>
            <li><b>PID (Process ID):</b> A unique identifier for the process.</li>
            <li><b>State:</b> The current state of the process (Ready, Running, Waiting, Terminated).</li>
            <li><b>PC (Program Counter):</b> The address of the next instruction to be executed.</li>
            <li><b>Registers:</b> The values of the CPU registers (e.g., A, B, C, D) at a given point in time.</li>
            <li><b>Memory Address:</b> The base address of the memory allocated to the process.</li>
            <li><b>Priority:</b> The priority of the process, used for scheduling.</li>
        </ul>

        <h3>Context Switching</h3>
        <p>Context switching is the process of saving the state of the current process and loading the state of another process. This allows the OS to switch between processes quickly, giving the illusion of concurrency. The steps involved are:</p>
        <ol>
            <li>Save the state of the current process (PC, registers, etc.) into its PCB.</li>
            <li>Select the next process to run.</li>
            <li>Load the state of the next process from its PCB.</li>
            <li>Start executing the next process.</li>
        </ol>

        <h3>Scheduling Algorithms</h3>
        <p>Scheduling algorithms determine which process should be executed next. Common algorithms include:</p>
        <ul>
            <li><b>First-Come, First-Served (FCFS):</b> Processes are executed in the order they arrive.</li>
            <li><b>Shortest Job First (SJF):</b> Processes with the shortest burst time are executed first.</li>
            <li><b>Priority Scheduling:</b> Processes with higher priority are executed first.</li>
        </ul>
    </div>

    <div id="Objective" class="tabcontent">
        <h2>Objective</h2>
        <ul>
            <li>By the end of this lab, you will be able to create processes and observe their state transitions.</li>
            <li>You will be able to identify the key components of a Process Control Block (PCB).</li>
            <li>You will be able to manually trigger a context switch and observe the changes in the PCB.</li>
        </ul>
    </div>

    <div id="Procedure" class="tabcontent">
        <h2>Procedure</h2>
        <ol>
            <li>Click the 'Create Process' button to generate a new process.</li>
            <li>Observe the process appear in the process visualization area.</li>
            <li>Click the 'Context Switch' button to switch to the next ready process.</li>
            <li>Examine the PCB display to see the current state of the running process.</li>
            <li>Use the input fields in the PCB display to validate your understanding of the PCB contents.</li>
        </ol>
    </div>

    <div id="Simulation" class="tabcontent">
        <h2>Simulation</h2>
        <div id="process-visualization">
            <!-- Processes will be displayed here -->
        </div>

        <div id="pcb-display">
            <!-- PCB details will be displayed here -->
        </div>

        <div id="controls">
            <button id="create-process">Create Process</button>
            <button id="context-switch">Context Switch</button>
        </div>

        <div id="log">
            <!-- Log messages will be displayed here -->
        </div>
    </div>

    <div id="Pretest" class="tabcontent">
        <h2>Pretest Questions</h2>
        <div id="quiz-container">
            <div class="quiz-question">
                <p>1. Which of the following is NOT a process state?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q1" value="a"> (a) Ready</label>
                    <label><input type="radio" name="q1" value="b"> (b) Running</label>
                    <label><input type="radio" name="q1" value="c"> (c) Blocked</label>
                    <label><input type="radio" name="q1" value="d"> (d) Terminated</label>
                </div>
                <p id="q1-feedback" class="quiz-feedback"></p>
            </div>

            <div class="quiz-question">
                <p>2. What does PCB stand for?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q2" value="a"> (a) Process Control Block</label>
                    <label><input type="radio" name="q2" value="b"> (b) Program Communication Block</label>
                    <label><input type="radio" name="q2" value="c"> (c) Process Communication Buffer</label>
                    <label><input type="radio" name="q2" value="d"> (d) Program Control Buffer</label>
                </div>
                <p id="q2-feedback" class="quiz-feedback"></p>
            </div>

            <div class="quiz-question">
                <p>3. Which of the following is stored in the PCB?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q3" value="a"> (a) Process ID</label>
                    <label><input type="radio" name="q3" value="b"> (b) Program Counter</label>
                    <label><input type="radio" name="q3" value="c"> (c) Registers</label>
                    <label><input type="radio" name="q3" value="d"> (d) All of the above</label>
                </div>
                <p id="q3-feedback" class="quiz-feedback"></p>
            </div>

            <div class="quiz-question">
                <p>4. What is context switching?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q4" value="a"> (a) Switching between different applications</label>
                    <label><input type="radio" name="q4" value="b"> (b) Saving the state of one process and loading the state of another</label>
                    <label><input type="radio" name="q4" value="c"> (c) Creating a new process</label>
                    <label><input type="radio" name="q4" value="d"> (d) Terminating a process</label>
                </div>
                <p id="q4-feedback" class="quiz-feedback"></p>
            </div>

            <div class="quiz-question">
                <p>5. Which process state indicates that the process is waiting for an event to occur?</p>
                <div class="quiz-options">
                    <label><input type="radio" name="q5" value="a"> (a) Ready</label>
                    <label><input type="radio" name="q5" value="b"> (b) Running</label>
                    <label><input type="radio" name="q5" value="c"> (c) Waiting</label>
                    <label><input type="radio" name="q5" value="d"> (d) Terminated</label>
                </div>
                <p id="q5-feedback" class="quiz-feedback"></p>
            </div>

            <button id="submit-quiz">Submit Quiz</button>
            <div id="quiz-results"></div>
        </div>
    </div>

    <script>
        // Tab functionality
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Open the default tab on page load
        document.getElementById("defaultOpen").click();

        // Simulation Code
        // Process states
        const ProcessState = {
            READY: "Ready",
            RUNNING: "Running",
            WAITING: "Waiting",
            TERMINATED: "Terminated"
        };

        class Process {
            constructor(pid) {
                this.pid = pid;
                this.state = ProcessState.READY;
                this.pc = 0; // Program Counter
                this.registers = { A: 0, B: 0, C: 0, D: 0 }; // Example registers
                this.priority = Math.floor(Math.random() * 10); // Random priority
                this.creationTime = Date.now();
                this.waitTime = 0;
                this.burstTime = Math.floor(Math.random() * 10000); // Simulate burst time (ms)
                this.memoryAddress = Math.floor(Math.random() * 1000); // Simulate memory address
            }
        }

        class PCB {
            constructor(process) {
                this.pid = process.pid;
                this.state = process.state;
                this.pc = process.pc;
                this.registers = { ...process.registers }; // Copy registers
                this.memoryAddress = process.memoryAddress;
                this.priority = process.priority;
            }
        }

        let processes = [];
        let nextPid = 1; // Start PID counter
        let currentProcess = null; // Currently running process

        const createProcessButton = document.getElementById("create-process");
        const contextSwitchButton = document.getElementById("context-switch");
        const processVisualization = document.getElementById("process-visualization");
        const pcbDisplay = document.getElementById("pcb-display");
        const logElement = document.getElementById("log");

        function log(message) {
            const logEntry = document.createElement("p");
            logEntry.textContent = message;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight; // Auto-scroll to bottom
        }

        function updateVisualization() {
            processVisualization.innerHTML = ""; // Clear existing visualization

            processes.forEach(process => {
                const processDiv = document.createElement("div");
                processDiv.classList.add("process");
                processDiv.innerHTML = `PID: ${process.pid}, State: ${process.state}`;
                processVisualization.appendChild(processDiv);
            });
        }

        function updatePCBDisplay(process) {
            if (!process) {
                pcbDisplay.innerHTML = "No process selected.";
                return;
            }

            const pcb = new PCB(process); // Create PCB from current process
            pcbDisplay.innerHTML = `
                <h3>PCB (PID: ${pcb.pid})</h3>
                <p>State: ${pcb.state}</p>
                <p>PC: <input type="number" id="pc-input" value="${pcb.pc}"></p>
                <p>Registers: A=<input type="number" id="register-a-input" value="${pcb.registers.A}">, B=<input type="number" id="register-b-input" value="${pcb.registers.B}">, C=<input type="number" id="register-c-input" value="${pcb.registers.C}">, D=<input type="number" id="register-d-input" value="${pcb.registers.D}"></p>
                <p>Memory Address: ${pcb.memoryAddress}</p>
                <p>Priority: ${pcb.priority}</p>
                <button id="validate-button">Validate</button>
            `;

            const validateButton = document.getElementById("validate-button");
            validateButton.addEventListener("click", () => {
                const pcInput = document.getElementById("pc-input").value;
                const registerAInput = document.getElementById("register-a-input").value;
                const registerBInput = document.getElementById("register-b-input").value;
                const registerCInput = document.getElementById("register-c-input").value;
                const registerDInput = document.getElementById("register-d-input").value;

                let isValid = true;
                if (parseInt(pcInput) !== currentProcess.pc) {
                    log("Validation Error: PC is incorrect.");
                    isValid = false;
                }
                if (parseInt(registerAInput) !== currentProcess.registers.A) {
                    log("Validation Error: Register A is incorrect.");
                    isValid = false;
                }
                if (parseInt(registerBInput) !== currentProcess.registers.B) {
                    log("Validation Error: Register B is incorrect.");
                    isValid = false;
                }
                if (parseInt(registerCInput) !== currentProcess.registers.C) {
                    log("Validation Error: Register C is incorrect.");
                    isValid = false;
                }
                if (parseInt(registerDInput) !== currentProcess.registers.D) {
                    log("Validation Error: Register D is incorrect.");
                    isValid = false;
                }

                if (isValid) {
                    log("Validation Successful!");
                }
            });
        }

        createProcessButton.addEventListener("click", () => {
            const newProcess = new Process(nextPid++);
            processes.push(newProcess);
            updateVisualization();
            log(`Process ${newProcess.pid} created.`);
        });

        contextSwitchButton.addEventListener("click", () => {
            if (processes.length === 0) return;

            if (currentProcess) {
                currentProcess.state = ProcessState.READY; // Back to ready
            }

            let nextProcessIndex = (processes.findIndex(p => p.pid === (currentProcess ? currentProcess.pid : 0)) + 1) % processes.length;
            let attempts = 0;
            while (processes[nextProcessIndex].state !== ProcessState.READY && attempts < processes.length) {
                nextProcessIndex = (nextProcessIndex + 1) % processes.length;
                attempts++;
            }

            if (attempts === processes.length) {
                console.log("No processes in READY state.");
                return; // No process to switch to
            }

            currentProcess = processes[nextProcessIndex];
            currentProcess.state = ProcessState.RUNNING;
            updateVisualization();
            updatePCBDisplay(currentProcess);
            log(`Context switch to process ${currentProcess.pid}.`);
        });

        // Quiz functionality
        const submitQuizButton = document.getElementById("submit-quiz");
        const quizResultsDiv = document.getElementById("quiz-results");

        submitQuizButton.addEventListener("click", () => {
            let score = 0;
            const answers = {
                q1: "c",
                q2: "a",
                q3: "d",
                q4: "b",
                q5: "c"
            };

            for (let i = 1; i <= 5; i++) {
                const selectedOption = document.querySelector(`input[name="q${i}"]:checked`);
                const feedbackElement = document.getElementById(`q${i}-feedback`);

                if (selectedOption) {
                    if (selectedOption.value === answers[`q${i}`]) {
                        score++;
                        feedbackElement.textContent = "Correct!";
                        feedbackElement.style.color = "green";
                    } else {
                        feedbackElement.textContent = "Incorrect.";
                        feedbackElement.style.color = "red";
                    }
                } else {
                    feedbackElement.textContent = "Please select an answer.";
                    feedbackElement.style.color = "red";
                }
            }

            quizResultsDiv.textContent = `Your score: ${score} / 5`;
        });
    </script>

</body>
</html>